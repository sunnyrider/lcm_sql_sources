SELECT DISTINCT COMPLAINT_CAUSE_UID FROM BAK_BSI_X_COMPLAINT_CAUSE
;
SELECT DISTINCT step_uid FROM CBU_UC_STEP_LANGUAGE
;

SELECT DISTINCT STATUS_UID FROM BSI_CASE
;
--UC_UID	TEXT
--112135	Eskalierte Bearbeitung
--75958		In Arbeit
--75957		Eingang
--112134	Überfällige Bearbeitung
--75959		Erledigt

SELECT DISTINCT STATUS_UID FROM BSI_X_COMPLAINT
;
--UC_UID	TEXT
--109054	Beanstandung im AFT falls Kunde "gelb"
--109053	Abgeschlossen
--109058	Bei DIR erfasst
--109056	Abklärung erledigt
--119169	In Bearbeitung
--119170	Abgeschlossen
--109057	Wieder eröffnet
--119166	Neu
--109059	Abgelehnt
--128898	Warten auf Rückmeldung
--109060	Offen
-- 109053, 119170

SELECT DISTINCT
	UC.UC_UID,
	UCT.TEXT 
FROM BSI_UC_TEXT uct
	INNER JOIN BSI_UC uc ON UC.UC_UID = UCT.UC_UID
WHERE UC.UC_UID IN (SELECT DISTINCT STATUS_UID FROM BSI_X_COMPLAINT)
AND UCT.LANGUAGE_UID = 246
;

SELECT DISTINCT
--	UC.UC_UID, 
	MIN (UC.UC_UID) AS mim_ucid,
	UCT.TEXT,
	uc.CODE_TYPE
FROM BSI_UC_TEXT uct 
	INNER JOIN BSI_UC uc 
	ON UC.UC_UID = UCT.UC_UID
WHERE UCT.LANGUAGE_UID = 246
--AND UC.UC_UID IN (SELECT DISTINCT COMPLAINT_CAUSE_UID FROM BAK_BSI_X_COMPLAINT_CAUSE)
--AND UC.CODE_TYPE = 75956
AND UC.UC_UID IN (SELECT DISTINCT step_uid FROM CBU_UC_STEP_LANGUAGE)
group BY UCT.TEXT, uc.CODE_TYPE
ORDER BY UCT.TEXT
;

SELECT DISTINCT
	MIN (UC.UC_UID) AS min_ucid,
	UCT.TEXT 
FROM BSI_UC_TEXT uct
	INNER JOIN BSI_UC uc ON UC.UC_UID = UCT.UC_UID
WHERE CODE_TYPE = 45831
AND UCT.LANGUAGE_UID = 246
GROUP BY UCT.TEXT
--ORDER BY UCT.TEXT
;


SELECT 
	XCPL.COMPANY_NR,
	XCPL.COMPLAINT_NR,
	XCPL.COMPLAINT_NO,
	XCPL.STATUS_UID AS xcpl_status,
	CSA.CASE_NR,
	CSA.CASE_NO,
	CSA.STATUS_UID AS case_status
FROM BSI_X_COMPLAINT xcpl 
	INNER JOIN BSI_X_CASE_COMPLAINT mcc 
		INNER JOIN BSI_CASE csa 
		ON CSA.CASE_NR = MCC.CASE_NR
	ON MCC.COMPLAINT_NR = XCPL.COMPLAINT_NR
WHERE CSA.STATUS_UID = 75959
--AND XCPL.COMPLAINT_NO = 1013111
AND XCPL.COMPANY_NR > 0
AND XCPL.STATUS_UID NOT IN (109053, 119170)
ORDER BY XCPL.COMPANY_NR, XCPL.COMPLAINT_NO, CSA.CASE_NO
;

--MERGE INTO BSI_X_COMPLAINT uxcpl
--USING 
--(
--SELECT 
--	XCPL.COMPLAINT_NR
--FROM BSI_X_COMPLAINT xcpl 
--	INNER JOIN BSI_X_CASE_COMPLAINT mcc 
--		INNER JOIN BSI_CASE csa 
--		ON CSA.CASE_NR = MCC.CASE_NR
--	ON MCC.COMPLAINT_NR = XCPL.COMPLAINT_NR
--WHERE CSA.STATUS_UID = 75959
----AND XCPL.COMPLAINT_NO = 1013111
--AND XCPL.COMPANY_NR > 0
--AND XCPL.STATUS_UID NOT IN (109053, 119170)
--ORDER BY XCPL.COMPANY_NR, XCPL.COMPLAINT_NO, CSA.CASE_NO
--) wrongstate
--ON 
--(
--	UXCPL.COMPLAINT_NR = wrongstate.COMPLAINT_NR
--)
--WHEN MATCHED THEN
--UPDATE SET UXCPL.STATUS_UID = 119170
--;

