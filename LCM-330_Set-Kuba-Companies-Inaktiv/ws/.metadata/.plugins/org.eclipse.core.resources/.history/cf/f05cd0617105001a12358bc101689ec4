
MERGE INTO BSI_X_EXT_JOIN ext_join_update 
USING 
(
	SELECT BSI_X_EXT_JOIN__JOIN_NO FROM BSICRM_EXT.BSI_X_KUBA_DATA_JOIN
) reset_active
ON
(
	reset_active.BSI_X_EXT_JOIN__JOIN_NO = ext_join_update.JOIN_NO
)
WHEN MATCHED THEN 
	UPDATE SET ext_join_update.ACTIVE = 1
;


SELECT DISTINCT
	EJJ.JOIN_NO kuba_join_no,
	XKD.JOIN_NR kuba_join_nr
FROM BSI_X_EXT_KUBA_DATA xkd 
	INNER JOIN BSI_X_EXT_JOIN_JOIN ejj
		INNER JOIN BSI_X_EXT_JOIN ej 
		ON EJ.EXT_JOIN_NR = EJJ.EXT_JOIN_NR
		AND EJ.EXT_JOIN_TYPE_UID = EJJ.EXT_JOIN_TYPE_UID
		INNER JOIN BSI_COMPANY cmp
		ON CMP.COMPANY_NR = EJJ.JOIN_NR
	ON EJJ.EXT_JOIN_NR = XKD.JOIN_NR
WHERE EJJ.IS_MASTER = 0
AND EJ.INTERFACE_UID NOT IN (108187, 108205) -- samba / nxdsmp, Küba: 131309
AND EJ.ACTIVE = 1
ORDER BY kuba_join_no
;

SELECT count(DISTINCT EJJ.JOIN_NO) AS Anzahl
FROM BSI_X_EXT_KUBA_DATA xkd 
	INNER JOIN BSI_X_EXT_JOIN_JOIN ejj
		INNER JOIN BSI_X_EXT_JOIN ej 
		ON EJ.EXT_JOIN_NR = EJJ.EXT_JOIN_NR
		AND EJ.EXT_JOIN_TYPE_UID = EJJ.EXT_JOIN_TYPE_UID
	ON EJJ.EXT_JOIN_NR = XKD.JOIN_NR
WHERE EJJ.IS_MASTER = 0
AND EJ.INTERFACE_UID NOT IN (108187, 108205) -- samba / nxdsmp, Küba: 131309
AND EJ.ACTIVE = 1
;
-- 324981